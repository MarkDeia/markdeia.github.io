<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>NVIDIA Jetson Nano 折腾记 | Mark&#39;s Blog</title>
<meta name="description" content="开啥玩笑呢">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="https://markdeia.github.io/favicon.ico?v=1654377045324">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://markdeia.github.io/styles/main.css">


  

  
    <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css" />
  

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


  </head>
  <body>
  
    <nav class="navbar border fixed split-nav">
  <div class="nav-brand">
    <h3><a href="https://markdeia.github.io">Mark&#39;s Blog</a></h3>
  </div>
  <div class="collapsible">
    <input id="collapsible1" type="checkbox" name="collapsible1">
    <button>
      <label for="collapsible1">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </label>
    </button>
    <div class="collapsible-body">
      <ul class="inline">
        
          <li>
            
              <a href="/" class="menu">
                首页
              </a>
            
          </li>
        
          <li>
            
              <a href="/archives" class="menu">
                归档
              </a>
            
          </li>
        
          <li>
            
              <a href="/tags" class="menu">
                标签
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/about" class="menu">
                关于
              </a>
            
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div id="top" class="row site">
      <div class="sm-12 md-8 col">
        <div class="paper">
          <article class="article">
            <h1>NVIDIA Jetson Nano 折腾记</h1>
            <p class="article-meta">
              2022-06-05
              
                <a href="https://markdeia.github.io/tag/Icvp7bvGa/" class="badge success">
                  学术
                </a>
              
                <a href="https://markdeia.github.io/tag/vhRE4ULaQb/" class="badge success">
                  编程
                </a>
              
            </p>
            
              <img src="https://markdeia.github.io/post-images/jetson-nano-setting-up.jpg" alt="NVIDIA Jetson Nano 折腾记">
            
            <div class="post-content">
              <p>本文介绍jetson nano 从入手到跑模型的流程一些记录，包括自己踩的很多坑，以供后人和自己查阅。</p>
<h1 id="硬件配置">硬件配置</h1>
<p>我这里的nano（b01）是国产版本，是以emmc（内置闪存）进行启动的，容量只有16GiB。<br>
这是我的附加配件：</p>
<ul>
<li>512GiB的m.2 nvme硬盘（后期空间开销真的很大，用于挂载到根目录，emmc的16G绝对不够） *1</li>
<li>2.4/5Ghz 双频无线网卡 板载 支持MIMO（理论最大速度867Mbps）*1</li>
<li>32GiB SanDisk UHS-I microSD卡 *1</li>
<li>5dBi无线网卡天线 *2</li>
</ul>
<h1 id="安装系统">安装系统</h1>
<p>拆开主板的静电袋，首先就是把系统给装上。使用虚拟机安装Ubuntu18.04（理论上更高也没问题），安装<a href="https://developer.nvidia.com/nvidia-sdk-manager">NVIDIA SDK manager</a>，让jetson进入恢复模式，连接到虚拟机上的SDK manager，静候烧录，用时大概一两个小时左右吧，这里厂家应该有指导文件，就不细说了。<br>
这里我选择先烧录系统，于是遇上了第一个坑：<br>
如果先烧录系统，后连接到SDK manager下载NVIDIA的组件，<strong>请将系统语言保持英文</strong>，否则会出现：<br>
<img src="https://markdeia.github.io/post-images/1654374020371.png" alt="" loading="lazy"><br>
安装NVIDIA组件的时候最好先在nano上换源（中科大、清华等等），要不然也容易卡在第三个检查步骤。</p>
<h1 id="安装设备树驱动">安装设备树（驱动）</h1>
<p>请遵循厂家说明文件 我这里需要挂载的是外置SD读写器<br>
将你的dtb文件复制到/boot目录下<br>
<code>sudo cp filename.dtb /boot</code><br>
编辑/boot/extlinux/extlinux.conf配置文件<br>
<code>sudo gedit /boot/extlinux/extlinux.conf</code></p>
<p>在<code>INITRD /boot/initrd</code>下面增加这一行内容<br>
<code>FDT /boot/filename.dtb</code></p>
<h1 id="将系统迁移到-nvme硬盘sdcard-上">将系统迁移到 NVME硬盘/SDcard 上</h1>
<p>NVMe SSD 硬盘仅作为系统盘（rootfs 和用户区），系统的启动引导依然是通过EMMC，比如升级设备树dtb 还是在 SD 卡或 EMMC 中。</p>
<h2 id="格式化硬盘sdcard">格式化硬盘/SDcard</h2>
<p>打开 Ubuntu18.04 自带 Disks 工具，找到安装的 ssd 硬盘,首先按键&quot;Ctrl+F”将其快速格式化为ext4格式，<img src="https://markdeia.github.io/post-images/1654374598715.png" alt="" loading="lazy"><br>
<img src="https://markdeia.github.io/post-images/1654374676911.png" alt="" loading="lazy"><br>
点击三角符号挂载<img src="https://markdeia.github.io/post-images/1654374702441.png" alt="" loading="lazy"></p>
<h2 id="克隆rootonnvme项目">克隆rootOnNVMe项目</h2>
<p><code>git clone https://github.com/jetsonhacks/rootOnNVMe.git</code><br>
修改 rootOnNVME 文件中的以下三个文件:<br>
copy-rootfs-ssd.sh<br>
data/setssdroot.sh<br>
data/setssdroot.service 需要将以上三个文件中对应的设备号/dev/nvme0n1p1 修改为Disks工具中，硬盘/SD卡 对应的设备号/dev/******，其他无需更改，执行脚本开始迁移系统。<br>
<code>./copy-rootfs-ssd.sh</code><br>
<code>./setup-service.sh</code><br>
重启设备<br>
<code>sudo reboot</code><br>
重启后通过命令 <code>df -h</code> 查看 ssd 或者 sd 卡是否挂载在系统/(根目录)来判断操作是否成功，当然也可以直接在设置中查看系统详情的硬盘大小来确认。</p>
<h1 id="安装远程桌面">安装远程桌面</h1>
<p>这里我推荐xRDP，VNC不推荐，因为纯远程启动折腾起来非常麻烦。</p>
<pre><code>sudo apt install xrdp
sudo apt install xfce4 xfce4-terminal
# 向xsession中写入xfce4-session
echo &quot;xfce4-session&quot; &gt;~/.xsession
# 设置配置文件
sudo vim /etc/xrdp/startwm.sh
</code></pre>
<p>在<code>. /etc/X11/Xsession</code>前面加<br>
<code>xfce4-session</code><br>
如图所示：<img src="https://img-blog.csdnimg.cn/1a6c969bd67a4bb4ac7a66bfe8b2a215.png" alt="" loading="lazy"><br>
最后<br>
<code>sudo systemctl enable xrdp</code><br>
打开Windows远程桌面mstsc，输入远程ubuntu的IP地址，进行远程连接。<br>
xfce4应该无法使用原生的terminal，你可以把Applications-Settings-Preferred Applilcations，打开Preferred Applilcations后，选择Utilities，修改Terminal Emulator，由于我使用的是xfce4桌面，因此选择了xfce Terminal</p>
<h2 id="调整-xrdp-配置参数">调整 Xrdp 配置参数</h2>
<p>编辑 <code>/etc/xrdp/xrdp.ini</code></p>
<pre><code>tcp_send_buffer_bytes=116777216
tcp_recv_buffer_bytes=116777216
</code></pre>
<p>将以下内容写入配置文件 <code>/etc/sysctl.conf</code>末尾</p>
<pre><code>net.core.rmem_max = 12582912
net.core.wmem_max = 8388608
</code></pre>
<p>然后执行<code>sudo sysctl -p</code></p>
<h2 id="重启-xrdp-服务生效">重启 xrdp 服务生效</h2>
<p><code>sudo systemctl restart xrdp</code></p>
<h1 id="apt换国内源">apt换国内源</h1>
<pre><code>#添加root密码
sudo passwd root
#备份存nano源原文件
sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
#编辑该文件
sudo vi /etc/apt/sources.list

#拷贝到文件中
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic main multiverse restricted universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-security main multiverse restricted universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-updates main multiverse restricted universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-backports main multiverse restricted universe
deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic main multiverse restricted universe
deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-security main multiverse restricted universe
deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-updates main multiverse restricted universe
deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-backports main multiverse restricted universe
#更新下源
sudo apt-get update    
    
#更新下软件
sudo apt-get full-upgrade  

</code></pre>
<h1 id="检查cuda-cudnn-opencv-是否安装完整">检查CUDA CUDNN OpenCV 是否安装完整</h1>
<h2 id="cuda-的配置">CUDA 的配置</h2>
<pre><code>#查看是否正确 
nvcc -V
</code></pre>
<p>显示如下图配置正确：<br>
<img src="https://img-blog.csdnimg.cn/2020072520055372.png#pic_center" alt="" loading="lazy"></p>
<h2 id="检查cudnn">检查CUDNN</h2>
<p>刚刚在SDK manager中我们已经安装好了cuda及cudnn，运行下mnist案例验证下cudnn是否可用。</p>
<pre><code>#进入案例文件
cd /usr/src/cudnn_samples_v8/mnistCUDNN/mnistCUDNN
#编译一下例子
sudo make 
# 为可执行文件添加执行权限
sudo chmod a+x mnistCUDNN 
#运行测试
./mnistCUDNN
</code></pre>
<p>运行成功为最后显示检测结果为：1 3 5</p>
<h2 id="检查opencv">检查OpenCV</h2>
<p>python3下查看Opencv正常使用及版本</p>
<pre><code>import cv2
print（cv2.__version__）
</code></pre>
<h1 id="安装conda">安装Conda</h1>
<p>由于Jetson为aarch64架构，目前不支持annconda；这里<a href="https://github.com/conda-forge/miniforge/releases">miniforge</a>和annconda使用方式基本一致。</p>
<pre><code>#上面官网链接下载
Mambaforge-4.9.2-7-Linux-aarch64.sh
#直接运行安装脚本；安装过程回有几个选项：要么回车要么yes。
sh ./Mambaforge-4.9.2-7-Linux-aarch64.sh
vim  ~/.bashrc
#最后面添加如下内容：
alias sudo=&quot;sudo env PATH=$PATH&quot;
#退出更新变量
source ~/.bashrc
#这是配置进入终端直接 是conda的base环境  false是关闭
conda config --set auto_activate_base false
</code></pre>
<h1 id="安装pinyinpippython3变更为默认">安装pinyin,pip,python3变更为默认</h1>
<h2 id="需要ssh传输文件需要安装lrzsz">需要ssh传输文件，需要安装lrzsz。</h2>
<p><code>sudo apt-get install lrzsz</code></p>
<h2 id="语言支持选择汉语图形界面下使用不需要可不装">语言支持选择汉语（图形界面下使用，不需要可不装）</h2>
<pre><code>sudo apt-get install ibus-pinyin
reboot
</code></pre>
<p>安装pip，pip更换阿里源（这里是本机原本的python环境）</p>
<pre><code>sudo apt-get install python3-pip

pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/

python -m pip install --upgrade pip
</code></pre>
<p>自带python2与python3，将Python3设置为默认。</p>
<pre><code>sudo update-alternatives --install /usr/bin/python python /usr/bin/python2 100
sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 150
python --version
 #显示为3.x.x就说明切换成功
Python 3.6.5
</code></pre>
<h1 id="swap交换空间增加">Swap交换空间增加</h1>
<p>Jetson Nano 内存为4G，显存与内存共用机制。使交换空间为12G，解决一些耗尽内存的程序出错（比如说编译。依次输入以下命令，并使其永久生效。</p>
<pre><code>sudo fallocate -l 12G /var/swapfile
sudo chmod 600 /var/swapfile
sudo mkswap /var/swapfile
sudo swapon /var/swapfile
sudo bash -c 'echo &quot;/var/swapfile swap swap defaults 0 0&quot; &gt;&gt; /etc/fstab'
</code></pre>

            </div>
          </article>
        </div>
        <div class="paper" data-aos="fade-in">
          
            <div class="next-post">
              <div class="next">
                下一篇
              </div>
              <a href="https://markdeia.github.io/post/simulated-annealing/">
                <h3 class="post-title">
                  模拟退火算法(Simulated Annealing)——简析
                </h3>
              </a>
            </div>
          
        </div>
        
          

          
            <div class="paper" data-aos="fade-in">
              <div id="disqus_thread"></div>
            </div>
          
        
      </div>

      <div class="sm-12 md-4 col sidebar">
  <div class="paper info-container">
    <img src="https://markdeia.github.io/images/avatar.png?v=1654377045324" class="no-responsive avatar">
    <div class="text-muted">开啥玩笑呢</div>
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      最新文章
    </div>
    <div class="row">
      <ul>
        
          
            <li>
              <a href="https://markdeia.github.io/post/jetson-nano-setting-up/">NVIDIA Jetson Nano 折腾记</a>
            </li>
          
        
          
            <li>
              <a href="https://markdeia.github.io/post/simulated-annealing/">模拟退火算法(Simulated Annealing)——简析</a>
            </li>
          
        
          
            <li>
              <a href="https://markdeia.github.io/post/how-to-use-credit-card/">玩转信用——我的信用卡把玩姿势</a>
            </li>
          
        
          
            <li>
              <a href="https://markdeia.github.io/post/quotations-collection/">语录收藏</a>
            </li>
          
        
          
            <li>
              <a href="https://markdeia.github.io/post/my-2021-summary/">我的2021总结</a>
            </li>
          
        
          
            <li>
              <a href="https://markdeia.github.io/post/about/">关于</a>
            </li>
          
        
      </ul>
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      标签列表
    </div>
    <div class="row">
      
        <a href="https://markdeia.github.io/tag/Icvp7bvGa/" class="badge secondary">
          学术
        </a>
      
        <a href="https://markdeia.github.io/tag/vhRE4ULaQb/" class="badge warning">
          编程
        </a>
      
        <a href="https://markdeia.github.io/tag/XWlk-c3mUU/" class="badge secondary">
          算法
        </a>
      
        <a href="https://markdeia.github.io/tag/life/" class="badge secondary">
          生活
        </a>
      
    </div>
  </div>
  <div class="paper">
    © 1989-2022 <b>Mark's Blog</b>  | <a class="rss" href="https://markdeia.github.io/atom.xml" target="_blank">RSS</a>
  </div>
</div>


    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

</script>



  

  
    <script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>
    <script>

    var options = {
      shortname: 'markdeia',
      apikey: 'oQaSn5H1mUvMfCAdAvq4XBDUIFYXvvS9V0h62Ip8gRkVv3vY1oInZThfCSuidA1g',
    }
    if ('') {
      options.api = ''
    }
    var dsqjs = new DisqusJS(options)

    </script>
  




  </body>
</html>
